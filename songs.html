<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Music - Hurst Class Study</title>
    <link rel="stylesheet" href="style.css?v=33">
    <style>
        /* Sticky player container - COMPACT */
        .sticky-player {
            position: sticky;
            top: 20px;
            z-index: 50;
            margin-bottom: 2rem;
        }
        
        /* Compact player panel */
        .compact-player {
            background: 
                repeating-linear-gradient(
                    90deg,
                    rgba(42, 38, 33, 0.15) 0px,
                    rgba(35, 32, 28, 0.1) 0.5px,
                    transparent 1px,
                    transparent 3px
                ),
                rgba(42, 38, 33, 0.5);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            box-shadow: 
                inset 0 3px 10px rgba(0, 0, 0, 0.5),
                0 4px 15px rgba(0, 0, 0, 0.4);
            border-left: 2px solid rgba(212, 165, 116, 0.4);
        }
        
        /* Now playing header - very compact */
        .now-playing-header {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #d4a574;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        /* Current song info - compact */
        .current-song-info {
            margin-bottom: 1rem;
        }
        
        .current-song-title {
            font-size: 1.3rem;
            color: #e8e4dc;
            margin-bottom: 0.25rem;
            font-family: Georgia, serif;
        }
        
        .current-song-artist {
            font-size: 0.9rem;
            color: #a8a49b;
            font-style: italic;
        }
        
        /* Play this song button */
        .play-this-song-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            max-width: 300px;
            margin: 2rem auto;
            padding: 1rem 2rem;
            background: linear-gradient(180deg, #c9a47a 0%, #b89968 100%);
            color: #2a231d;
            border: none;
            border-radius: 8px;
            font-family: Georgia, serif;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .play-this-song-btn:hover {
            background: linear-gradient(180deg, #d4af84 0%, #c2a372 100%);
            transform: translateY(-2px);
            box-shadow: 
                0 6px 16px rgba(212, 165, 116, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        .play-this-song-btn:active {
            transform: translateY(0);
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        /* Song panels */
        .song-panel {
            margin-bottom: 2rem;
        }
        
        /* Player controls */
        .player-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .control-btn {
            background: linear-gradient(135deg, rgba(42, 38, 33, 0.9) 0%, rgba(30, 28, 25, 0.95) 100%);
            border: 1px solid rgba(212, 165, 116, 0.4);
            color: #d4a574;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(212, 165, 116, 0.1);
        }
        
        .control-btn:hover {
            background: linear-gradient(135deg, rgba(52, 48, 43, 0.9) 0%, rgba(40, 38, 35, 0.95) 100%);
            box-shadow: 
                0 4px 12px rgba(212, 165, 116, 0.3),
                inset 0 1px 0 rgba(212, 165, 116, 0.2);
        }
        
        .control-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        
        /* Repeat button active state */
        .control-btn.repeat-active {
            color: #f0d4a8;
            border-color: #f0d4a8;
            box-shadow: 
                0 0 15px rgba(240, 212, 168, 0.5),
                inset 0 1px 0 rgba(240, 212, 168, 0.3);
        }
        
        /* Current song info */
        .current-song-info {
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .current-song-title {
            font-size: 1.8rem;
            color: #e8e4dc;
            margin-bottom: 0.5rem;
            font-family: Georgia, serif;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="back-link">
            <a href="index.html">&larr; Back to All Lessons</a>
        </div>
        
        <header class="lesson-header">
            <h1>THE MUSIC</h1>
            <p class="scripture-reference">Songs from The Tenth Hour</p>
        </header>
        
        <!-- Sticky Compact Player -->
        <div class="sticky-player">
            <div class="compact-player">
                <div class="now-playing-header">Now Playing</div>
                <div class="current-song-info">
                    <div class="current-song-title" id="current-title">Select a song to begin</div>
                    <div class="current-song-artist">A song by The Tenth Hour</div>
                </div>
                
                <div class="custom-audio-player" id="main-player" style="display:none;">
                    <audio id="main-audio"></audio>
                    
                    <!-- Previous/Play/Next Controls -->
                    <div class="player-controls">
                        <button id="prev-btn" class="control-btn" aria-label="Previous Song">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
                        </button>
                        
                        <button id="play-pause-btn" class="player-button" aria-label="Play/Pause">
                            <svg class="play-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                            <svg class="pause-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="display:none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                        </button>
                        
                        <button id="next-btn" class="control-btn" aria-label="Next Song">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
                        </button>
                        
                        <button id="repeat-btn" class="control-btn" aria-label="Repeat All">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>
                        </button>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 0.75rem; width: 100%;">
                        <div id="current-time" class="time-display">0:00</div>
                        <input type="range" id="seek-bar" class="seek-bar" value="0" min="0" max="100" aria-label="Audio seek bar">
                        <div id="duration" class="time-display">0:00</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Ornate Divider -->
        <div class="divider-ornate"></div>
        
        <!-- Song List Section - Full Details -->
        <section class="lesson-summary">
            <h2>All Songs</h2>
            <p class="preview-text">Browse and select songs from the collection</p>
            
            <div id="song-list">
                <!-- Songs will be dynamically inserted here as full panels -->
            </div>
        </section>
    </div>
    
    <script src="data.js"></script>
    <script>
        let currentSongIndex = -1;
        let isRepeatAll = false;
        
        const audio = document.getElementById('main-audio');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playIcon = playPauseBtn.querySelector('.play-icon');
        const pauseIcon = playPauseBtn.querySelector('.pause-icon');
        const seekBar = document.getElementById('seek-bar');
        const currentTimeEl = document.getElementById('current-time');
        const durationEl = document.getElementById('duration');
        const audioPlayer = document.getElementById('main-player');
        const currentTitle = document.getElementById('current-title');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const repeatBtn = document.getElementById('repeat-btn');
        const songList = document.getElementById('song-list');
        
        // Format time helper
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Detect which lesson they came from
        const urlParams = new URLSearchParams(window.location.search);
        const fromLessonId = urlParams.get('from');
        let autoLoadIndex = -1;
        
        if (fromLessonId) {
            autoLoadIndex = lessonData.findIndex(lesson => lesson.id === fromLessonId);
        }
        
        // Build song list as full panels
        lessonData.forEach((lesson, index) => {
            if (lesson.audio_file) {
                const songPanel = document.createElement('div');
                songPanel.className = 'song-panel';
                songPanel.dataset.index = index;
                songPanel.id = `song-${index}`;
                
                songPanel.innerHTML = `
                    <div class="divider-ornate"></div>
                    <section class="song-section">
                        <h2>${lesson.song_title}</h2>
                        <p class="song-attribution">
                            A song by The <img src="logo.svg" alt="Tenth Hour" class="inline-logo">
                        </p>
                        ${lesson.image_url ? `<img src="${lesson.image_url}" alt="${lesson.song_title}" class="song-image">` : ''}
                        
                        <button class="play-this-song-btn" data-index="${index}">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="#d4a574" d="M8 5v14l11-7z"/></svg>
                            Play This Song
                        </button>
                        
                        ${lesson.song_lyrics ? `
                            <details class="accordion lyrics-accordion">
                                <summary>View Song Lyrics</summary>
                                <div class="accordion-content lyrics-content">
                                    <div class="lyrics-text">${lesson.song_lyrics}</div>
                                </div>
                            </details>
                        ` : ''}
                        
                        ${lesson.suno_link ? `
                            <p class="suno-link">
                                Can't play? <a href="${lesson.suno_link}" target="_blank" rel="noopener">Listen on Suno â†’</a>
                            </p>
                        ` : ''}
                    </section>
                `;
                
                songList.appendChild(songPanel);
            }
        });
        
        // Add click handlers to play buttons
        document.querySelectorAll('.play-this-song-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const index = parseInt(btn.dataset.index);
                loadSong(index);
                // Scroll to top to see player
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
        
        // Load a song
        function loadSong(index) {
            currentSongIndex = index;
            const lesson = lessonData[index];
            
            // Update UI
            currentTitle.textContent = lesson.song_title;
            audio.src = lesson.audio_file;
            
            audioPlayer.style.display = 'flex';
            
            // Auto-play
            audio.play();
            playIcon.style.display = 'none';
            pauseIcon.style.display = 'inline-block';
            audioPlayer.classList.add('playing');
        }
        
        // Auto-load song if coming from a lesson page
        if (autoLoadIndex !== -1) {
            setTimeout(() => {
                loadSong(autoLoadIndex);
            }, 500);
        }
        
        // Play/Pause
        playPauseBtn.addEventListener('click', () => {
            if (currentSongIndex === -1) return;
            
            if (audio.paused) {
                audio.play();
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'inline-block';
                audioPlayer.classList.add('playing');
            } else {
                audio.pause();
                playIcon.style.display = 'inline-block';
                pauseIcon.style.display = 'none';
                audioPlayer.classList.remove('playing');
            }
        });
        
        // Previous song
        prevBtn.addEventListener('click', () => {
            if (currentSongIndex > 0) {
                loadSong(currentSongIndex - 1);
            } else if (isRepeatAll) {
                loadSong(lessonData.length - 1);
            }
        });
        
        // Next song
        nextBtn.addEventListener('click', () => {
            if (currentSongIndex < lessonData.length - 1) {
                loadSong(currentSongIndex + 1);
            } else if (isRepeatAll) {
                loadSong(0);
            }
        });
        
        // Repeat toggle
        repeatBtn.addEventListener('click', () => {
            isRepeatAll = !isRepeatAll;
            repeatBtn.classList.toggle('repeat-active', isRepeatAll);
        });
        
        // Time updates
        audio.addEventListener('timeupdate', () => {
            if (audio.duration) {
                seekBar.value = (audio.currentTime / audio.duration) * 100;
                currentTimeEl.textContent = formatTime(audio.currentTime);
            }
        });
        
        audio.addEventListener('loadedmetadata', () => {
            durationEl.textContent = formatTime(audio.duration);
        });
        
        // Seek
        seekBar.addEventListener('input', () => {
            audio.currentTime = (seekBar.value / 100) * audio.duration;
        });
        
        // Auto-play next
        audio.addEventListener('ended', () => {
            if (currentSongIndex < lessonData.length - 1) {
                loadSong(currentSongIndex + 1);
            } else if (isRepeatAll) {
                loadSong(0);
            } else {
                playIcon.style.display = 'inline-block';
                pauseIcon.style.display = 'none';
                audioPlayer.classList.remove('playing');
            }
        });
        
        // Media Session API
        if ('mediaSession' in navigator) {
            audio.addEventListener('loadedmetadata', () => {
                const lesson = lessonData[currentSongIndex];
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: lesson.song_title,
                    artist: 'The Tenth Hour',
                    album: 'Hurst Class Study: Book of John',
                    artwork: lesson.image_url ? [
                        { src: lesson.image_url, sizes: '512x512', type: 'image/jpeg' }
                    ] : []
                });
            });
            
            navigator.mediaSession.setActionHandler('play', () => audio.play());
            navigator.mediaSession.setActionHandler('pause', () => audio.pause());
            navigator.mediaSession.setActionHandler('previoustrack', () => prevBtn.click());
            navigator.mediaSession.setActionHandler('nexttrack', () => nextBtn.click());
        }
    </script>
</body>
</html>
