<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson - Hurst Class Study</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="back-link">
            <a href="index.html">← Back to All Lessons</a>
        </div>

        <article id="lesson-content">
            </article>

        <nav class="lesson-navigation">
            </nav>
    </div>

    <script src="data.js"></script>
    <script>
        // Get the lesson ID from the URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const lessonId = urlParams.get('id');

        // Find the lesson in the data
        const currentLesson = lessonData.find(lesson => lesson.id === lessonId);

        if (!currentLesson) {
            // Lesson not found
            document.getElementById('lesson-content').innerHTML = `
                <div class="error-message">
                    <h1>Lesson Not Found</h1>
                    <p>Sorry, we couldn't find the lesson you're looking for.</p>
                    <a href="index.html" class="button">Return to All Lessons</a>
                </div>
            `;
        } else {
            // Update page title
            document.title = currentLesson.title + ' - Hurst Class Study';

            // Build the lesson content
            const lessonContent = document.getElementById('lesson-content');
            
            lessonContent.innerHTML = `
                <header class="lesson-header">
                    <h1>${currentLesson.title}</h1>
                    <p class="scripture-reference">${currentLesson.scripture}</p>
                </header>

                <section class="lesson-summary">
                    <h2>Lesson Summary</h2>
                    <p class="preview-text">${currentLesson.summary_preview}</p>
                    <details class="accordion">
                        <summary>Read the Full Lesson</summary>
                        <div class="accordion-content">
                            <p>${currentLesson.summary_full}</p>
                        </div>
                    </details>
                </section>

                <section class="song-tie-in">
                    <h2>Song Tie-in</h2>
                    <p class="preview-text">${currentLesson.tie_in_preview}</p>
                    <details class="accordion">
                        <summary>Read About the Song</summary>
                        <div class="accordion-content">
                            <p>${currentLesson.tie_in_full}</p>
                        </div>
                    </details>
                </section>

                <section class="song-section">
                    <h2>${currentLesson.song_title}</h2>
                    ${currentLesson.image_url ? `<img src="${currentLesson.image_url}" alt="${currentLesson.song_title}" class="song-image">` : ''}
                    
                    ${currentLesson.audio_file ? `
                        <div class="custom-audio-player">
                            <audio id="lesson-audio" src="${currentLesson.audio_file}"></audio>
                            
                            <button id="play-pause-btn" class="player-button">
                                <svg class="play-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                                <svg class="pause-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="display:none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                            </button>
                            <div id="current-time" class="time-display">0:00</div>
                            <input type="range" id="seek-bar" class="seek-bar" value="0" min="0" max="100">
                            <div id="duration" class="time-display">0:00</div>
                        </div>
                    ` : ''}
                    ${currentLesson.suno_link ? `
                        <p class="suno-link">
                            Can't play? <a href="${currentLesson.suno_link}" target="_blank" rel="noopener">Listen on Suno →</a>
                        </p>
                    ` : ''}
                </section>
            `;

            // Build navigation links
            const currentIndex = lessonData.findIndex(lesson => lesson.id === lessonId);
            const navSection = document.querySelector('.lesson-navigation');
            
            let navHTML = '<div class="nav-links">';
            
            // Previous lesson link
            if (currentIndex > 0) {
                const prevLesson = lessonData[currentIndex - 1];
                navHTML += `
                    <a href="lesson.html?id=${prevLesson.id}" class="nav-link prev-link">
                        ← Previous Lesson: ${prevLesson.title}
                    </a>
                `;
            } else {
                navHTML += '<span class="nav-link-placeholder"></span>';
            }
            
            // Next lesson link
            if (currentIndex < lessonData.length - 1) {
                const nextLesson = lessonData[currentIndex + 1];
                navHTML += `
                    <a href="lesson.html?id=${nextLesson.id}" class="nav-link next-link">
                        Next Lesson: ${nextLesson.title} →
                    </a>
                `;
            } else {
                navHTML += '<span class="nav-link-placeholder"></span>';
            }
            
            navHTML += '</div>';
            navSection.innerHTML = navHTML;

            // === NEW JAVASCRIPT FOR CUSTOM PLAYER ===
            // This code must run *after* the innerHTML is set
            if (currentLesson.audio_file) {
                const audio = document.getElementById('lesson-audio');
                const playPauseBtn = document.getElementById('play-pause-btn');
                const playIcon = playPauseBtn.querySelector('.play-icon');
                const pauseIcon = playPauseBtn.querySelector('.pause-icon');
                const seekBar = document.getElementById('seek-bar');
                const currentTimeEl = document.getElementById('current-time');
                const durationEl = document.getElementById('duration');

                // Helper function to format time in 0:00
                function formatTime(seconds) {
                    const minutes = Math.floor(seconds / 60);
                    const secs = Math.floor(seconds % 60);
                    return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
                }

                // Play/Pause functionality
                playPauseBtn.addEventListener('click', () => {
                    if (audio.paused) {
                        audio.play();
                        playIcon.style.display = 'none';
                        pauseIcon.style.display = 'inline-block';
                    } else {
                        audio.pause();
                        playIcon.style.display = 'inline-block';
                        pauseIcon.style.display = 'none';
                    }
                });

                // Update seek bar and time as audio plays
                audio.addEventListener('timeupdate', () => {
                    const progress = (audio.currentTime / audio.duration) * 100;
                    seekBar.value = progress;
                    currentTimeEl.textContent = formatTime(audio.currentTime);
                });

                // Set total duration when audio loads
                audio.addEventListener('loadedmetadata', () => {
                    durationEl.textContent = formatTime(audio.duration);
                    seekBar.max = audio.duration; // Set max for easier seeking
                });
                
                // Allow user to seek by dragging the bar
                seekBar.addEventListener('input', () => {
                    audio.currentTime = seekBar.value;
                });
                
                // Reset player when audio ends
                audio.addEventListener('ended', () => {
                    playIcon.style.display = 'inline-block';
                    pauseIcon.style.display = 'none';
                    seekBar.value = 0;
                    currentTimeEl.textContent = '0:00';
                });
            }
            // === END NEW JAVASCRIPT ===
        }
    </script>
</body>
</html>
